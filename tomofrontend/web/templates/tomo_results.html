{% extends "base.html" %}
{% block title %}Результаты реконструкции{% endblock %}
{% block body %}
    <div class="container" xmlns="http://www.w3.org/1999/html">
        <header class="jumbotron subhead" id="overview">

            <p class="lead">
                Результат реконструкции объекта {{ tomo_object['data_dir'] }}
            </p>

            <div class="subnav subnav-fixed">
                <ul class="nav nav-pills">
                    <li >
                        <a href="{{ url_for('tomo_info',tomo_object_id=tomo_object['id']) }}">
                            Информация об объекте
                        </a>
                    </li>

                    <li>
                        <a href="{{ url_for('tomo_process',tomo_object_id=tomo_object['id']) }}"> Процесс реконструкции  </a>
                    </li>

                    <li class="active">
                        <a href="#">
                            Результат реконструкции
                        </a>
                    </li>

                </ul>
            </div>
        </header>

        <div class="span12">
            <ul id="myTab" class="nav nav-tabs">
                <li class="active"><a href="#files" data-toggle="tab">Get files</a></li>
                <li><a href="#images_x" data-toggle="tab">Images X</a></li>
                <li><a href="#images_y" data-toggle="tab">Images Y</a></li>
                <li><a href="#images_z" data-toggle="tab">Images Z</a></li>
                <li><a href="#videos" data-toggle="tab">Video files</a></li>
                <li><a href="#amira" data-toggle="tab">Custom amira files</a></li>

            </ul>

            <div id="myTabContent" class="tab-content">
                <div class="tab-pane fade in active" id="files">
                    <div>
                        <label> Получить файлы</label>
                        <ul>
                            <li>
                                <a href="{{ url_for('get_file', tomo_object_id= tomo_object['id']) }}?fname=reconstruction/postproc_data.h5">
                                    HDF5 файл с  предобработанными данными
                                </a>
                            </li>
                            <li>
                                <a href="{{ url_for('get_file', tomo_object_id= tomo_object['id']) }}?fname=reconstruction/result.hdf5">
                                    HDF5 файл с результатом
                                </a>
                            </li>
                            <li>
                                <a href="{{ url_for('get_file', tomo_object_id= tomo_object['id']) }}?fname=reconstruction/amira.raw">
                                    Бинарный файл AMIRA
                                </a>
                            </li>
                            <li>
                                <a href="{{ url_for('get_file', tomo_object_id= tomo_object['id']) }}?fname=reconstruction/tomo.hx">
                                    HX файл AMIRA
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="tab-pane fade" id="images_x">
                    <div class="row">
                        {% for f in tomo_object.get_files_list('reconstruction/images/x_*.png') %}
                        <div class="span6">
                            <h3>{{ f }}</h3>
                            <img src="{{ url_for('get_file', tomo_object_id= tomo_object['id']) }}?fname={{ f }}"/>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="tab-pane fade" id="images_y">
                    <div class="row">
                        {% for f in tomo_object.get_files_list('reconstruction/images/y_*.png') %}
                            <div class="span6">
                                <h3>{{ f }}</h3>
                                <img src="{{ url_for('get_file', tomo_object_id= tomo_object['id']) }}?fname={{ f }}"/>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="tab-pane fade" id="images_z">
                    <div class="row">
                        {% for f in tomo_object.get_files_list('reconstruction/images/z_*.png') %}
                            <div class="span6">
                                <h3>{{ f }}</h3>
                                <img src="{{ url_for('get_file', tomo_object_id= tomo_object['id']) }}?fname={{ f }}"/>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="tab-pane fade" id="videos">
                    <div class="row">
                        {% for f in tomo_object.get_userdata_files()['video'] %}
                            <div class="span12">
                                <a href="{{ url_for('get_file', tomo_object_id= tomo_object['id']) }}?fname={{ f }}">{{ f }} </a>
                            </div>
                            {% if f.split('.')[-1]== 'mkv' %}
                                <div class="span12">
                                    <video class="video-js vjs-default-skin" controls preload="auto" width="640" height="480" data-setup="{}">
                                        <source src="{{ url_for('get_file', tomo_object_id= tomo_object['id']) }}?fname={{ f }}" type='video/mp4'>
                                    </video>
                                </div>
                            {% endif %}

                        {% endfor %}

                        <div class="span12">
                            <p>Для конвертирования файлов в проигрываемый формат используйте: ffmpeg -i file_name.mpg  -sameq -vcodec libx264 -acodec copy  -crf 23 file_name.mkv</p>
                        </div>

                    </div>
                </div>
                <div class="tab-pane fade" id="amira">
                    <div class="row">
                        {% for f in tomo_object.get_userdata_files()['amira']  %}
                            <div class="span6">
                                <a href="{{ url_for('get_file', tomo_object_id= tomo_object['id']) }}?fname={{ f }}">
                                    {{ f }}
                            </a>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

        </div>
    </div>
{% endblock%}

{% block my_scripts %}
    <link href="video-js/video-js.css" rel="stylesheet">
    <script src="video-js/video.js"></script>
{% endblock %}